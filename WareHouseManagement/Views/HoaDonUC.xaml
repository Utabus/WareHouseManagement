<UserControl x:Class="WareHouseManagement.Views.HoaDonUC"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WareHouseManagement.Views"
             mc:Ignorable="d" 
                xmlns:hc="https://handyorg.github.io/handycontrol"
             >

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Tiêu đề -->
        <Label Grid.Row="0" Content="Quản lý Hóa đơn" 
               FontSize="24" FontWeight="Bold"
               Height="40"
               Background="Transparent"
               BorderThickness="0"
               HorizontalContentAlignment="Center"
               VerticalContentAlignment="Center"/>

        <!-- Thanh công cụ -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,10" >
            <TextBlock Text="Từ ngày:" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding FromDate}" Width="150" Margin="5,0"/>

            <TextBlock Text="Đến ngày:" VerticalAlignment="Center"/>
            <DatePicker SelectedDate="{Binding ToDate}" Width="150" Margin="5,0"/>
            <TextBox Width="180"
         Margin="10,0,0,0"
         Text="{Binding Keyword, UpdateSourceTrigger=PropertyChanged}"
         VerticalAlignment="Center"
          hc:InfoElement.Placeholder="Tìm khách / mã..."
         />
            <Button Content="Làm mới" Command="{Binding RefreshCommand}" Margin="10,0"/>

            <Button Content="Tìm kiếm" Command="{Binding LoadRevenueStatisticsCommand}" Margin="10,0"/>


        </StackPanel>
        <StackPanel Grid.Row="2" Orientation="Horizontal" VerticalAlignment="Top" Margin="0,0,0,10">
            <TextBlock Text="Tổng công nợ: " FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TongCongNo, StringFormat={}{0:N0} VNĐ}" 
     Foreground="Red" FontSize="16" FontWeight="Bold" Margin="5,0"/>
        </StackPanel>

        <!-- Bảng danh sách hóa đơn -->
        <DataGrid ItemsSource="{Binding Invoices}"
                  SelectedItem="{Binding SelectedInvoice}"
          MouseDoubleClick="DataGrid_MouseDoubleClick"
                  Grid.Row="3" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False" SelectionMode="Single">
            <DataGrid.Columns>
                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="*"/>
                <DataGridTextColumn Header="Tên khách hàng" Binding="{Binding CustomerName}" Width="*"/>
                <DataGridTextColumn Header="Mã hóa đơn" Binding="{Binding InvoiceCode}" Width="*"/>
                <DataGridTextColumn Header="Ngày" Binding="{Binding InvoiceDate}" Width="*"/>
                <DataGridTextColumn Header="Loại" Binding="{Binding Type}" Width="*"/>
                <DataGridTextColumn Header="Tổng tiền" Binding="{Binding TotalAmount, StringFormat={}{0:N0} VNĐ}" Width="*"/>
                <DataGridTextColumn Header="Lợi nhuận" Binding="{Binding Profit, StringFormat={}{0:N0} VNĐ}" Width="*"/>
                <DataGridTemplateColumn Header="Công nợ" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock>
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Đã thanh toán"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDebt}" Value="True">
                                                <Setter Property="Text" Value="Công nợ"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>

                </DataGridTemplateColumn>
                
                
                <DataGridTemplateColumn Header="Thao tác" Width="*">
                    <DataGridTemplateColumn.HeaderTemplate>
                        <DataTemplate>
                            <TextBlock Text="Thao tác"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.HeaderTemplate>

                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="Cập nhật"
                Width="Auto"
                Command="{Binding DataContext.CapNhatCongNoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                CommandParameter="{Binding}">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDebt}" Value="True">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>

                </DataGridTemplateColumn>



            </DataGrid.Columns>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Foreground" Value="Black"/>

                    <Style.Triggers>

                        <!-- Tô nền đỏ nhẹ khi IsDebt = true -->
                        <DataTrigger Binding="{Binding IsDebt}" Value="True">
                            <Setter Property="Background" Value="#FFFFD6D6"/>
                        </DataTrigger>

                        <!-- Khi chọn dòng: chữ luôn màu đen -->
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Foreground" Value="Black"/>
                        </Trigger>

                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>


        </DataGrid>

    </Grid>
</UserControl>
